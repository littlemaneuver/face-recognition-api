import pytest
from flask import url_for
from werkzeug.datastructures import FileStorage


class ViewTestMixin(object):
    files = {
        "file_one_face": "test/assets/test_face_1.jpeg",
        "file_two_faces": "test/assets/test_face_2.jpeg",
        "file_three_faces": "test/assets/test_face_3.jpeg",
        "file_unsupported": "test/assets/test_pdf.pdf",
        "file_apple": "test/assets/test_apple.jpg",
    }
    encodings = {
        "file_one_face": [-0.09228415787220001, 0.08809339255094528, 0.02670697495341301, -0.05203229561448097, -0.05315952003002167, 0.009842321276664734, 0.044465694576501846, -0.0828610509634018, 0.20363949239253998, -0.0030663711950182915, 0.12975628674030304, 0.0269060879945755, -0.2716989815235138, 0.03427879884839058, -0.08074932545423508, 0.11946691572666168, -0.13904762268066406, -0.0402798131108284, -0.14084970951080322, -0.141730397939682, -0.0038903644308447838, 0.10278280824422836, 0.13807763159275055, -0.01133526861667633, -0.15636324882507324, -0.2790655195713043, -0.03647630289196968, -0.12999309599399567, -0.0019865278154611588, -0.06351425498723984, 0.05144018679857254, 0.0030254055745899677, -0.23873259127140045, -0.07055789232254028, 0.011446552351117134, 0.03942514955997467, -0.10834404081106186, -0.0029599210247397423, 0.14382225275039673, 0.016755040735006332, -0.15500523149967194, 0.09131201356649399, 0.12874771654605865, 0.2537946403026581, 0.18089745938777924, 0.028233349323272705, -0.01882547326385975, -0.05520714074373245, 0.03454514220356941, -0.2380763590335846, 0.10928942263126373, 0.0715961679816246, 0.06821054965257645, 0.052291352301836014, 0.12603937089443207, -0.1257823258638382, 0.011106597259640694, 0.10769165307283401, -0.1397167444229126, 0.09547796100378036, 0.1566120982170105, 0.008537506684660912, -0.0018465910106897354, 0.02688906528055668, 0.12023929506540298, 0.06554658710956573, -0.10580463707447052, -0.11837108433246613, 0.024211587384343147, -0.1867642104625702, -0.0014423485845327377, 0.024324551224708557, -0.06545023620128632, -0.15832990407943726, -0.2938336133956909, 0.09411297738552094, 0.34546831250190735, 0.11195317655801773, -0.08095744252204895, 0.012640966102480888, -0.06779651343822479, 0.0204722099006176, 0.049952853471040726, -0.006270022597163916, -0.09671010076999664, -0.05375351756811142, -0.0921500027179718, 0.026420176029205322, 0.13826309144496918, -0.026578905060887337, -0.06966739147901535, 0.1939919888973236, -0.01983959600329399, -0.06640014052391052, -0.011729337275028229, 0.07318129390478134, -0.2305218130350113, 0.012004729360342026, -0.15367281436920166, 0.012525411322712898, -0.024408960714936256, -0.08714748919010162, 0.00021264469251036644, 0.07954072207212448, -0.16528154909610748, 0.12292051315307617, -0.030988750979304314, -0.0865529328584671, -0.0030328454449772835, 0.08755199611186981, -0.15793950855731964, -0.05592590942978859, 0.11546459048986435, -0.2046634703874588, 0.25810688734054565, 0.18109861016273499, -0.0001883192453533411, 0.11147067695856094, 0.10889581590890884, 0.03848116099834442, 0.016377368941903114, 0.1632203757762909, -0.09005966782569885, -0.10751654207706451, 0.018677230924367905, -0.03334839642047882, 0.06331990659236908, 0.04868307709693909],
        "file_two_faces": [-0.07171458005905151, -0.02929401397705078, 0.10362786799669266, -0.0075844647362828255, -0.14636623859405518, -0.16440331935882568, -0.036299873143434525, -0.16492316126823425, 0.06407404690980911, -0.13555525243282318, 0.18098315596580505, -0.027183007448911667, -0.17761431634426117, -0.04918830469250679, 0.041099898517131805, 0.15859335660934448, -0.04371481016278267, -0.18987996876239777, -0.14949347078800201, -0.10758642852306366, -0.08706816285848618, -0.00941981840878725, 0.03782614320516586, -0.00010058796033263206, -0.08910883218050003, -0.3255608081817627, -0.11372805386781693, -0.10274559259414673, 0.037585556507110596, -0.07836665958166122, -0.020181238651275635, 0.018326450139284134, -0.17990204691886902, -0.1352235972881317, 0.07367526739835739, 0.02979978360235691, -0.05867687612771988, -0.06949584186077118, 0.2415328472852707, 0.03670778498053551, -0.2112816423177719, 0.07480692118406296, 0.0676831528544426, 0.29757073521614075, 0.18739333748817444, 0.011957848444581032, 0.06604806333780289, -0.034477654844522476, 0.12447072565555573, -0.2803267538547516, 0.15557695925235748, -0.0005311965942382812, 0.20207275450229645, -0.01248997263610363, 0.17075975239276886, -0.13662943243980408, 0.029277954250574112, 0.14041468501091003, -0.2083132565021515, 0.17338819801807404, 0.17185616493225098, -0.1214522123336792, -0.08122526854276657, -0.04032670706510544, 0.2151722013950348, 0.15396186709403992, -0.059576235711574554, -0.05936160683631897, 0.16493567824363708, -0.11082479357719421, -0.03983154892921448, -0.055837273597717285, -0.08626943826675415, -0.11781888455152512, -0.32230210304260254, 0.04204122722148895, 0.31805041432380676, 0.13349036872386932, -0.24788640439510345, -0.00782735925167799, 0.010451609268784523, 0.1065075546503067, 0.07335522025823593, -0.01450051087886095, -0.09897566586732864, -0.043201252818107605, -0.08736852556467056, 0.010074306279420853, 0.1600874364376068, -0.022086497396230698, -0.029968585819005966, 0.15565089881420135, -0.04178278148174286, -0.04578365013003349, 0.08506438881158829, 0.02003011852502823, -0.15495720505714417, -0.09014414250850677, -0.17118188738822937, -0.02185942232608795, 0.09794628620147705, -0.09299996495246887, 0.0632270872592926, 0.0882580354809761, -0.19457902014255524, 0.11708712577819824, -0.09639494866132736, -0.058072954416275024, -0.023676788434386253, 0.03591419756412506, -0.08874926716089249, -0.00740525359287858, 0.09490133076906204, -0.15669715404510498, 0.2559854984283447, 0.18387112021446228, -0.03403405472636223, 0.11462952941656113, 0.06644786894321442, -0.031091658398509026, -0.022679928690195084, 0.044405341148376465, -0.11534671485424042, -0.1333816647529602, 0.03713862970471382, 0.014780220575630665, 0.10220196843147278, 0.10561993718147278],
        "file_three_faces": [-0.09651173651218414, 0.016010669991374016, 0.03536465764045715, -0.026906682178378105, -0.014438357204198837, -0.08632947504520416, -0.006630594842135906, -0.020713018253445625, 0.1444159597158432, 0.0643700435757637, 0.1661008894443512, -0.029053762555122375, -0.27629509568214417, -0.06498810648918152, -0.010097288526594639, 0.13590829074382782, -0.07321656495332718, -0.04010330140590668, -0.09614314138889313, -0.14112603664398193, 0.030858036130666733, 0.03874882310628891, 0.11667423695325851, 0.019224558025598526, -0.10781584680080414, -0.3329293131828308, -0.06887772679328918, -0.12759505212306976, -0.039916254580020905, -0.14128009974956512, 0.01312806736677885, 0.13687855005264282, -0.18298809230327606, -0.11227498948574066, 0.00612170435488224, 0.1242445856332779, 0.05077067390084267, -0.0335262157022953, 0.1839059293270111, 0.046142254024744034, -0.11651788651943207, 0.071421317756176, 0.06461496651172638, 0.1976698935031891, 0.2345830500125885, 0.029677273705601692, 0.03680335730314255, -0.004964152351021767, 0.0971502959728241, -0.23492150008678436, 0.08015500009059906, 0.06687858700752258, 0.12444734573364258, 0.03485359996557236, 0.093640998005867, -0.12758545577526093, -0.017209427431225777, 0.10187400877475739, -0.12714436650276184, 0.05604315549135208, -0.002178994007408619, -0.08291008323431015, -0.04910970851778984, 0.002182162366807461, 0.08417822420597076, 0.0648522600531578, -0.056529488414525986, -0.05232257395982742, 0.10007358342409134, -0.10532763600349426, -0.04279889911413193, 0.05028177797794342, -0.13101334869861603, -0.13229387998580933, -0.3020690381526947, 0.11575667560100555, 0.31901970505714417, 0.06404691189527512, -0.22274932265281677, 0.05742844566702843, -0.05190468952059746, 0.009881655685603619, -0.0026373490691184998, 0.013148549012839794, -0.04572634398937225, -0.02918250486254692, -0.13389618694782257, -0.0013805609196424484, 0.14587874710559845, -0.01909058913588524, -0.06014033406972885, 0.1813422590494156, -0.03606536239385605, 0.109080970287323, 0.046554550528526306, 0.1048809364438057, -0.10572923719882965, -0.03925888612866402, -0.1208871528506279, -0.07503639161586761, 0.11965221911668777, -0.098516546189785, -0.03960053622722626, 0.04532299563288689, -0.1906403750181198, 0.07647529989480972, -0.04249914735555649, -0.03964811563491821, -0.01049787551164627, 0.057536978274583817, -0.01845770701766014, 0.010063291527330875, 0.13840758800506592, -0.1865551918745041, 0.19873851537704468, 0.2218230664730072, -0.11690156906843185, 0.14106766879558563, 0.048744481056928635, 0.09146527200937271, -0.005248783156275749, 0.04064423590898514, -0.0801052376627922, -0.11688721925020218, 0.03783457353711128, 0.10095423460006714, 0.012318408116698265, 0.06817540526390076],
        "mean": [-0.08683682481447856, 0.024936682855089504, 0.05523316686352094, -0.028841147509713966, -0.07132137194275856, -0.08029682437578838, 0.0005117421969771385, -0.08949907682836056, 0.13737649967273077, -0.024750526684025925, 0.15894677738348642, -0.009776894003152847, -0.2418694645166397, -0.026632537444432575, -0.016582238487899303, 0.13798952102661133, -0.08532633259892464, -0.09008769442637761, -0.12882877389589945, -0.13014762103557587, -0.020033497052888077, 0.04403727098057667, 0.0975260039170583, 0.0025962338161965213, -0.11776264260212581, -0.3125185469786326, -0.0730273611843586, -0.12011124690373738, -0.0014390752961238225, -0.09438700477282207, 0.014795671838025251, 0.05274346858883897, -0.20054091016451517, -0.10601882636547089, 0.030414508034785587, 0.06448983959853649, -0.038750081012646355, -0.035327326195935406, 0.18975367645422617, 0.033201693246761955, -0.16093492011229196, 0.07918008416891098, 0.08701527863740921, 0.24967842300732931, 0.20095794896284738, 0.02328949049115181, 0.02800864912569523, -0.03154964931309223, 0.0853887212773164, -0.25110820432504016, 0.1150071273247401, 0.0459811861316363, 0.13157688329617181, 0.024884993210434914, 0.1301467070976893, -0.1299990713596344, 0.00772504135966301, 0.11666011561950047, -0.1583914558092753, 0.10830310483773549, 0.10876308971395095, -0.06527492962777615, -0.04406052269041538, -0.003751826472580433, 0.13986324022213617, 0.09478690475225449, -0.07397012040019035, -0.07668508837620418, 0.09640694968402386, -0.1343055466810862, -0.02802426554262638, 0.006256351868311564, -0.09424434105555217, -0.13614755620559058, -0.3060682515303294, 0.08397029340267181, 0.32751281062761944, 0.10316348572572072, -0.1838643898566564, 0.020747350839277107, -0.036416531230012573, 0.045620473412175976, 0.040223574886719383, -0.0025406614877283573, -0.08047070354223251, -0.04204575841625532, -0.10447157174348831, 0.011704640462994576, 0.14807642499605814, -0.02258533053100109, -0.053258770455916725, 0.1769950489203135, -0.032562579959630966, -0.0010342734555403392, 0.03996320068836212, 0.06603078295787175, -0.16373608509699503, -0.03913276642560959, -0.1485806182026863, -0.028123467539747555, 0.06439651486774285, -0.09288800011078517, 0.007946398574858904, 0.07104058439532916, -0.18350031475226083, 0.10549431294202805, -0.05662761566539606, -0.061424667636553444, -0.012402503130336603, 0.060334390650192894, -0.08838216091195743, -0.017755957165112097, 0.11625783642133077, -0.1826386054356893, 0.23761030038197836, 0.19559759895006815, -0.050374647680049144, 0.12238929172356923, 0.0746960553030173, 0.0329515915364027, -0.003850447634855906, 0.08275665094455083, -0.09517054011424382, -0.11926180869340897, 0.031216811388731003, 0.027462019585072994, 0.05928009438018004, 0.07415947318077087]
    }
 
    """
    Automatically load in a session and client, this is common for a lot of
    tests that work with views.
    """
    @pytest.fixture(autouse=True)
    def set_common_fixtures(self, session, client):
        self.session = session
        self.client = client

    def create_encoding(self, file_path):
        file_storage = FileStorage(stream=open(file_path, "rb"))

        return self.client.post(
            url_for("encodings.create_encoding"),
            data={"file": file_storage},
            content_type="multipart/form-data",
        )
